<!DOCTYPE html>
{% load static %}
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Обратная связь</title>
  <!-- Обратите внимание, что в Jinja статические файлы подключаются с помощью url_for -->
  <link rel="stylesheet" href="{% static 'circulation_page/css/page.css' %}">
  <link href="https://fonts.googleapis.com/css?family=Poppins:600" rel="stylesheet">
</head>
<body>
  {% if messages %}
        <div class="messages">
            {% for message in messages %}
                <div class="{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

  <img src="{% static 'circulation_page/img/iconCircle.png' %}" id="iconC">
  <img src="{% static 'circulation_page/img/iconsAdvert.png' %}" id="iconA">
  <div class="feedback-section">
    <h1 id='spec-head'>ОТПРАВИТЬ ОБРАЩЕНИЕ</h1>
    <!-- Действие формы может быть также сгенерировано с помощью url_for -->
      <form method="post" id="feedback-form" action="{% url 'submit_form' %}">

<!--    <form method="post" id="feedback-form" action="submit-form">-->
        {% csrf_token %}
        <div class="input-group">
          <label>Ваше сообщение</label>
            {{ form.full_text }}<br>
        </div>
            <button type="submit" id="submit-btn"><span>Отправить</span></button>
<!--        <button type="submit" id="submit-btn" style="vertical-align:middle"><span>Отправить</span></button>-->
    </form>

  </div>
  <div class="info-section">
    <div class="developers">
      <h2>РАЗРАБОТЧИКИ</h2>
        <p>Ратников Максим - Front-end</p>
        <p>Шебани Антон - DataScince, Backend</p>
        <p>Дьяков Никита - Backend</p>
        <p>Гречихин Никита - ML</p>
        <p>Виталий Нант - Design</p>
    </div>
  </div>
  <script>
    document.getElementById("submit-btn").addEventListener("click", function(event) {
      event.preventDefault(); // Предотвращает стандартную отправку формы

      // Отправка запроса на сервер методом POST
      var xhr = new XMLHttpRequest();
      xhr.open("POST", "/submit-form", true);
      xhr.setRequestHeader("X-CSRFToken", getCookie("csrftoken")); // Необходимо для работы с CSRF в Django
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");

      xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE) {
          if (xhr.status === 200) {
            alert("Тема: " + xhr.responseText); // Вывод ответа от сервера
          } else {
            alert("Ошибка: " + xhr.status);
          }
        }
      };

      // Сбор данных из формы и отправка
      var formData = new FormData(document.getElementById("feedback-form"));
      xhr.send(new URLSearchParams(formData).toString());
    });

    // Функция для получения значения куки
    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          let cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              let cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
    }
  </script>
  <div class="clickable-area">
      <script>
         document.addEventListener('DOMContentLoaded', function() {
        var area = document.querySelector('.clickable-area');
        var maxFlashes = 8;
        var flashes = [];

        setInterval(function() {
            if (flashes.length < maxFlashes) {
                createFlash(area);
            }
        }, 500);

        function createFlash(container) {
            var flash = document.createElement('div');
            flash.classList.add('flash');

            var x = Math.random() * container.offsetWidth;
            var y = Math.random() * container.offsetHeight;

            flash.style.left = x + 'px';
            flash.style.top = y + 'px';

            container.appendChild(flash);
            flashes.push(flash);

            setTimeout(function() {
                flash.remove();
                flashes.splice(flashes.indexOf(flash), 1);
            }, 2500);

            flash.classList.add('show');
        }
    });
    </script>
  </div>
</body>
</html>
